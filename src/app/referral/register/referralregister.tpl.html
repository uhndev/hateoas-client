<div class="container">
  <h2 id="Title" translate context-translator="APP.REFERRAL.REGISTER.LABELS.REFERRAL_REGISTRATION">
    APP.REFERRAL.REGISTER.LABELS.REFERRAL_REGISTRATION
  </h2>

  <br/>

  <ng-form name="referralForm" novalidate>
    <div class="form-horizontal">
      <div class="row">
        <div class="col-lg-6">
          <fieldset>
            <legend>
              <i class="fa fa-user"></i>
              <span translate context-translator="{{referralRegister.translatableTitles.referralTitle}}">
                {{referralRegister.translatableTitles.referralTitle}}
              </span>
            </legend>
            <div class="row">
              <div class="col-md-11">
                <div class="form-group" ng-class="{ 'has-error' : referralForm.client.$invalid && !referralForm.client.$pristine}">
                  <label class="control-label col-md-3" for="client"
                         translate context-translator="{{referralRegister.translatableTitles.client}}">
                    {{referralRegister.translatableTitles.client}}
                  </label>
                  <select-loader
                    id="client"
                    name="client"
                    class="col-md-9"
                    url="client"
                    is-atomic="true"
                    is-disabled="false"
                    ng-model="referralRegister.referral.client"
                    labels="displayName" required>
                  </select-loader>
                </div>

                <div class="form-group" ng-class="{ 'has-error' : referralForm.claimNumber.$invalid && !referralForm.claimNumber.$pristine}">
                  <label class="control-label col-md-3" for="claimNumber"
                         translate context-translator="{{referralRegister.translatableTitles.claimNumber}}">
                    {{referralRegister.translatableTitles.claimNumber}}
                  </label>
                  <div class="col-md-9">
                    <input id="claimNumber" type="text" class="form-control" name="claimNumber"
                           ng-model="referralRegister.referral.claimNumber" placeholder="Claim Number" required/>
                  </div>
                </div>

                <div class="form-group" ng-class="{ 'has-error' : referralForm.policyNumber.$invalid && !referralForm.policyNumber.$pristine}">
                  <label class="control-label col-md-3" for="policyNumber"
                         translate context-translator="{{referralRegister.translatableTitles.policyNumber}}">
                    {{referralRegister.translatableTitles.policyNumber}}
                  </label>
                  <div class="col-md-9">
                    <input id="policyNumber" type="text" class="form-control" name="policyNumber"
                           ng-model="referralRegister.referral.policyNumber" placeholder="Policy Number" />
                  </div>
                </div>

                <div class="form-group">
                  <label class="control-label col-md-3" for="site"
                         translate context-translator="{{referralRegister.translatableTitles.site}}">
                    {{referralRegister.translatableTitles.site}}
                  </label>
                  <select-loader
                    id="site"
                    name="site"
                    class="col-md-9"
                    url="site"
                    is-atomic="true"
                    is-disabled="false"
                    ng-model="referralRegister.referral.site"
                    labels="displayName">
                  </select-loader>
                </div>

                <div class="form-group">
                  <label class="control-label col-md-3" for="program"
                         translate context-translator="{{referralRegister.translatableTitles.program}}">
                    {{referralRegister.translatableTitles.program}}</label>
                  <select-loader
                    id="program"
                    name="program"
                    class="col-md-9"
                    url="program"
                    is-atomic="true"
                    is-disabled="false"
                    ng-model="referralRegister.referral.program"
                    labels="displayName">
                  </select-loader>
                </div>

                <div class="form-group">
                  <label class="control-label col-md-3" for="physician"
                         translate context-translator="{{referralRegister.translatableTitles.physician}}">
                    {{referralRegister.translatableTitles.physician}}
                  </label>
                  <select-loader
                    id="physician"
                    name="physician"
                    class="col-md-9"
                    url="physician"
                    is-atomic="true"
                    is-disabled="false"
                    ng-model="referralRegister.referral.physician"
                    labels="displayName">
                  </select-loader>
                </div>

                <div class="form-group">
                  <label class="control-label col-md-3" for="staff"
                         translate context-translator="{{referralRegister.translatableTitles.staff}}">
                    {{referralRegister.translatableTitles.staff}}
                  </label>
                  <select-loader
                    id="staff"
                    name="staff"
                    class="col-md-9"
                    url="staff"
                    is-atomic="true"
                    is-disabled="false"
                    ng-model="referralRegister.referral.staff"
                    labels="displayName">
                  </select-loader>
                </div>

                <div class="form-group">
                  <label class="control-label col-md-3" for="payors"
                         context-translator="{{referralRegister.translatableTitles.payors}}" translate>
                    {{referralRegister.translatableTitles.payors}}
                  </label>
                  <select-loader
                    id="payors"
                    name="payors"
                    class="col-md-9"
                    url="payor"
                    is-atomic="false"
                    is-disabled="false"
                    bind-object="true"
                    ng-model="referralRegister.referral.payors"
                    labels="displayName">
                  </select-loader>
                </div>

                <div class="form-group">
                  <label class="control-label col-md-3" for="referralComments"
                         context-translator="{{referralRegister.translatableTitles.referralComments}}" translate>
                    {{referralRegister.translatableTitles.referralComments}}
                  </label>
                  <div class="col-md-9">
                    <textarea class="form-control" ng-model="referralRegister.referral.referralComments"
                              id="referralComments" name="referralComments" rows="5" style="resize: none">
                    </textarea>
                  </div>
                </div>

              </div>
            </div>
          </fieldset>
        </div>

        <div class="col-lg-6">
          <fieldset>
            <legend>
              <i class="fa fa-calendar"></i>
              <span translate context-translator="{{referralRegister.translatableTitles.dateTitle}}">
                {{referralRegister.translatableTitles.dateTitle}}
              </span>
            </legend>
            <div class="row">
              <div class="col-md-12">
                <div class="form-group" ng-if="referralRegister.referral.id">
                  <label class="control-label col-md-3"
                         translate context-translator="{{referralRegister.translatableTitles.dateCreated}}">
                    {{referralRegister.translatableTitles.dateCreated}}
                  </label>
                  <div class="col-md-9">
                    <h5 ng-if="referralRegister.referral.createdAt">
                      {{referralRegister.referral.createdAt | date:'EEEE, MMMM d, y'}}
                    </h5>
                    <h5 ng-if="!referralRegister.referral.createdAt">
                      {{referralRegister.referral.referralDate | date:'EEEE, MMMM d, y'}}
                    </h5>
                  </div>
                </div>

                <div class="form-group">
                  <label class="control-label col-md-3"
                         translate context-translator="{{referralRegister.translatableTitles.referralDate}}">
                    {{referralRegister.translatableTitles.referralDate}}
                  </label>
                  <div class="col-md-9">
                    <p class="input-group">
                      <input name="referralDate"
                             ng-model="referralRegister.referral.referralDate"
                             class="form-control"
                             uib-datepicker-popup
                             type="date"
                             is-open="referralRegister.opened1" disabled format-date/>
                      <span class="input-group-btn">
                          <button type="button" class="btn btn-default" ng-click="referralRegister.opened1 = true">
                            <i class="glyphicon glyphicon-calendar"></i>
                          </button>
                      </span>
                    </p>
                  </div>
                </div>

                <div class="form-group">
                  <label class="control-label col-md-3" context-translator="{{referralRegister.translatableTitles.clinicDate}}"
                         translate>{{referralRegister.translatableTitles.clinicDate}}</label>
                  <div class="col-md-9">
                    <p class="input-group">
                      <input name="clinicDate"
                             ng-model="referralRegister.referral.clinicDate"
                             class="form-control"
                             uib-datepicker-popup
                             type="date"
                             is-open="referralRegister.opened2" disabled format-date/>
                      <span class="input-group-btn">
                          <button type="button" class="btn btn-default" ng-click="referralRegister.opened2 = true">
                            <i class="glyphicon glyphicon-calendar"></i>
                          </button>
                      </span>
                    </p>
                  </div>
                </div>

                <div class="form-group">
                  <label class="control-label col-md-3" context-translator="{{referralRegister.translatableTitles.accidentDate}}"
                         translate>{{referralRegister.translatableTitles.accidentDate}}</label>
                  <div class="col-md-9">
                    <p class="input-group">
                      <input name="accidentDate"
                             ng-model="referralRegister.referral.accidentDate"
                             class="form-control"
                             uib-datepicker-popup
                             type="date"
                             is-open="referralRegister.opened3" disabled format-date/>
                      <span class="input-group-btn">
                          <button type="button" class="btn btn-default" ng-click="referralRegister.opened3 = true">
                            <i class="glyphicon glyphicon-calendar"></i>
                          </button>
                      </span>
                    </p>
                  </div>
                </div>

                <div class="form-group">
                  <label class="control-label col-md-3" context-translator="{{referralRegister.translatableTitles.receiveDate}}"
                         translate>{{referralRegister.translatableTitles.receiveDate}}</label>
                  <div class="col-md-9">
                    <p class="input-group">
                      <input name="receiveDate"
                             ng-model="referralRegister.referral.receiveDate"
                             class="form-control"
                             uib-datepicker-popup
                             type="date"
                             is-open="referralRegister.opened4" disabled format-date/>
                      <span class="input-group-btn">
                          <button type="button" class="btn btn-default" ng-click="referralRegister.opened4 = true">
                            <i class="glyphicon glyphicon-calendar"></i>
                          </button>
                      </span>
                    </p>
                  </div>
                </div>

                <div class="form-group">
                  <label class="control-label col-md-3" context-translator="{{referralRegister.translatableTitles.sentDate}}"
                         translate>{{referralRegister.translatableTitles.sentDate}}</label>
                  <div class="col-md-9">
                    <p class="input-group">
                      <input name="sentDate"
                             ng-model="referralRegister.referral.sentDate"
                             class="form-control"
                             uib-datepicker-popup
                             type="date"
                             is-open="referralRegister.opened5" disabled format-date/>
                      <span class="input-group-btn">
                          <button type="button" class="btn btn-default" ng-click="referralRegister.opened5 = true">
                            <i class="glyphicon glyphicon-calendar"></i>
                          </button>
                      </span>
                    </p>
                  </div>
                </div>

                <div class="form-group">
                  <label class="control-label col-md-3" context-translator="{{referralRegister.translatableTitles.dischargeDate}}"
                         translate>{{referralRegister.translatableTitles.dischargeDate}}</label>
                  <div class="col-md-9">
                    <p class="input-group">
                      <input name="dischargeDate"
                             ng-model="referralRegister.referral.dischargeDate"
                             class="form-control"
                             uib-datepicker-popup
                             type="date"
                             is-open="referralRegister.opened6" disabled format-date/>
                      <span class="input-group-btn">
                          <button type="button" class="btn btn-default" ng-click="referralRegister.opened6 = true">
                            <i class="glyphicon glyphicon-calendar"></i>
                          </button>
                      </span>
                    </p>
                  </div>
                </div>

                <div class="form-group">
                  <label class="control-label col-md-3" for="status"
                         context-translator="{{referralRegister.translatableTitles.status}}" translate>
                    {{referralRegister.translatableTitles.status}}
                  </label>
                  <select-loader
                    id="status"
                    class="col-md-9"
                    url="status"
                    query="{'category': 'referral'}"
                    is-atomic="true"
                    is-disabled="false"
                    ng-model="referralRegister.referral.status"
                    labels="displayName">
                  </select-loader>
                </div>

                <div class="form-group">
                  <label class="control-label col-md-3" context-translator="{{referralRegister.translatableTitles.recMade}}"
                         translate>{{referralRegister.translatableTitles.recMade}}</label>
                  <input class="col-md-1" type="checkbox" ng-model="referralRegister.referral.recommendationsMade"/>
                </div>

              </div>
            </div>
          </fieldset>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <legend>
            <span class="glyphicon glyphicon-briefcase"></span>
            <span context-translator="{{referralRegister.translatableTitles.referralContacts}}" translate>
              {{referralRegister.translatableTitles.referralContacts}}
            </span>
            <i class="fa fa-plus-circle selectable pull-right" ng-click="referralRegister.referral.referralContacts.push({})"></i>
          </legend>

          <div class="panel panel-info" id="referralContacts" ng-repeat="employee in referralRegister.referral.referralContacts">
            <div class="panel-heading selectable" ng-click="employee.isCollapsed = !employee.isCollapsed">
              <i class="glyphicon" ng-class="{
                'glyphicon-chevron-right': !employee.isCollapsed,
                'glyphicon-chevron-down': employee.isCollapsed
              }"></i>
              <span>
                {{employee.occupation ? employee.occupation + ' - ' + employee.person.prefix + ' ' + employee.person.firstName + ' ' + employee.person.lastName : 'Please enter employee information'}}
                <span class="glyphicon glyphicon-trash pull-right" ng-click="referralRegister.removeEmployment($index, $event)"></span>
              </span>

              <div class="clearfix"></div>
            </div>
            <div class="panel-body" uib-collapse="!employee.isCollapsed">
              <employee-editor employee="employee"></employee-editor>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button ng-click="referralRegister.referralAdd(referralForm.$valid)" type="submit" ng-if="!referralRegister.referral.id"
              ng-disabled="referralForm.$invalid" class="btn btn-primary">
        <i class="fa fa-floppy-o"></i>
      <span translate context-translator="APP.REFERRAL.REGISTER.LABELS.CREATE_REFERRAL">
        APP.REFERRAL.REGISTER.LABELS.CREATE_REFERRAL
      </span>
      </button>
      <button ng-click="referralRegister.save(isValid)" type="submit" ng-if="referralRegister.referral.id"
              ng-disabled="referralForm.$invalid" class="btn btn-primary">
        <i class="fa fa-floppy-o"></i>
      <span translate context-translator="APP.REFERRAL.REGISTER.LABELS.UPDATE_REFERRAL">
        APP.REFERRAL.REGISTER.LABELS.UPDATE_REFERRAL
      </span>
      </button>
      <button ng-click="referralRegister.cancel()" ng-disabled="referralRegister.referral.$invalid"
              class="btn btn-default">
        <i class="fa fa-ban"></i>
      <span translate context-translator="APP.REFERRAL.REGISTER.LABELS.CANCEL">
        APP.REFERRAL.REGISTER.LABELS.CANCEL
      </span>
      </button>
    </div>

  </ng-form>
</div>
