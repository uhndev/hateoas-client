<div class="modal-header">
  <h3 class="modal-title" translate>COMMON.MODELS.STUDY.SUBJECTS.ADD</h3>
</div>
<div class="modal-body">
  <ng-form name="subjectForm" class="form-horizontal" novalidate>
    <div class="form-group" ng-class="{'has-error': subjectForm.username.$invalid && !subjectForm.username.$pristine}">
      <label for="username" class="col-sm-3 control-label" translate>COMMON.MODELS.USER.USERNAME</label>
      <div class="col-sm-9">
        <input type="text" name="username" class="form-control"
               data-ng-model="addSubject.newSubject.username"
               validation-check criteria="{model: 'user', attribute: 'username'}"
               ng-minlength="5"
               placeholder="johndoe" required>
        <p ng-show="subjectForm.username.$invalid && !subjectForm.username.$pristine"
           class="pull-right required-error" translate>COMMON.MODELS.SYSTEM_FORM.USER.QUESTIONS.INVALID_USERNAME</p>
      </div>
    </div>
    <div class="form-group" ng-class="{'has-error': subjectForm.email.$invalid && !subjectForm.email.$pristine}">
      <label for="email" class="col-sm-3 control-label" translate>COMMON.MODELS.USER.EMAIL</label>
      <div class="col-sm-9">
        <input type="email" name="email" class="form-control"
               data-ng-model="addSubject.newSubject.email"
               validation-check criteria="{model: 'user', attribute: 'email'}"
               placeholder="johndoe@email.com" required>
        <p ng-show="subjectForm.email.$invalid && !subjectForm.email.$pristine"
           class="pull-right required-error" translate>COMMON.MODELS.SYSTEM_FORM.USER.QUESTIONS.INVALID_EMAIL</p>
      </div>
    </div>
    <div class="form-group">
      <label for="password" class="col-sm-3 control-label" translate>APP.AUTH.PASSWORD</label>
      <div class="col-sm-9">
        <input type="text" name="password" class="form-control"
             ng-model="addSubject.newSubject.password" ng-minlength="8"
             ng-pattern="/(?=.*[a-z])(?=.*[^a-zA-Z])/"
             generate-password for-input="addSubject.newSubject.password"
             required disabled />
        <p ng-show="subjectForm.password.$invalid && !subjectForm.password.$pristine"
           class="pull-right required-error" translate>
          COMMON.MODELS.SYSTEM_FORM.USER.QUESTIONS.INVALID_PASSWORD
        </p>
      </div>
    </div>
    <div class="form-group">
      <label for="prefix" class="col-sm-3 control-label" translate>COMMON.MODELS.USER.PREFIX</label>
      <div class="col-sm-9">
        <select name="prefix" class="form-control" ng-model="addSubject.newSubject.prefix" required>
          <option value="" disabled>Select a prefix</option>
          <option value="Mr." label="Mr.">Mr.</option>
          <option value="Mrs." label="Mrs.">Mrs.</option>
          <option value="Ms." label="Ms.">Ms.</option>
          <option value="Dr." label="Dr.">Dr.</option>
        </select>
        <p ng-show="subjectForm.prefix.$invalid && !subjectForm.prefix.$pristine"
           class="pull-right required-error" translate>COMMON.MODELS.SYSTEM_FORM.USER.QUESTIONS.INVALID_INPUT</p>
      </div>
    </div>
    <div class="form-group">
      <label for="firstname" class="col-sm-3 control-label" translate>COMMON.MODELS.USER.FIRSTNAME</label>
      <div class="col-sm-9">
        <input type="text" name="firstname" class="form-control"
               data-ng-model="addSubject.newSubject.firstname"
               placeholder="John" required>
        <p ng-show="subjectForm.firstname.$invalid && !subjectForm.firstname.$pristine"
           class="pull-right required-error" translate>COMMON.MODELS.SYSTEM_FORM.USER.QUESTIONS.INVALID_INPUT</p>
      </div>
    </div>
    <div class="form-group">
      <label for="lastname" class="col-sm-3 control-label" translate>COMMON.MODELS.USER.LASTNAME</label>
      <div class="col-sm-9">
      <input type="text" name="lastname" class="form-control"
             data-ng-model="addSubject.newSubject.lastname"
             placeholder="Doe" required>
      <p ng-show="subjectForm.lastname.$invalid && !subjectForm.lastname.$pristine"
         class="pull-right required-error" translate>COMMON.MODELS.SYSTEM_FORM.USER.QUESTIONS.INVALID_INPUT</p>
      </div>
    </div>
    <div class="form-group">
      <label for="gender" class="col-sm-3 control-label" translate>COMMON.MODELS.USER.GENDER</label>
      <div class="col-sm-9">
      <select name="gender" class="form-control" ng-model="addSubject.newSubject.gender" required>
        <option value="" disabled>Select a gender</option>
        <option value="Male" label="Male">Male</option>
        <option value="Female" label="Female">Female</option>
      </select>
      <p ng-show="subjectForm.gender.$invalid && !subjectForm.gender.$pristine"
         class="pull-right required-error">Gender is required.</p>
      </div>
    </div>
    <div class="form-group">
      <label for="dob" class="col-sm-3 control-label" translate>COMMON.MODELS.SYSTEM_MODEL.USER.DATE_BIRTH</label>
      <div class="col-sm-9">
      <p class="input-group">
        <input name="dob" type="text" class="form-control" uib-datepicker-popup ng-model="addSubject.newSubject.dob"
               is-open="addSubject.openedDOB" required disabled/>
        <span class="input-group-btn">
          <button type="button" class="btn btn-default" ng-click="addSubject.openedDOB = true"><i class="glyphicon glyphicon-calendar"></i></button>
        </span>
        <p ng-show="subjectForm.dob.$invalid && !subjectForm.dob.$pristine"
           class="pull-right required-error" translate>COMMON.MODELS.SYSTEM_FORM.USER.QUESTIONS.INVALID_INPUT</p>
      </p>
      </div>
    </div>
  </ng-form>
  <hr/>
  <ng-form name="enrollmentForm" class="form-horizontal" novalidate>
    <div class="form-group">
      <label for="provider" class="col-sm-3 control-label" translate>COMMON.MODELS.STUDY.SUBJECTS.PROVIDERS.IDENTITY</label>
      <div class="col-sm-9" ng-if="addSubject.studyUsers">
        <select-loader
          url="provider"
          query="addSubject.studyUsers"
          is-atomic="false"
          is-disabled="false"
          ng-model="addSubject.newSubject.providers"
          labels="displayName">
        </select-loader>
      </div>
    </div>
    <div class="form-group">
      <label for="status" class="col-sm-3 control-label" translate>COMMON.MODELS.STUDY.SUBJECTS.PROVIDERS.STATUS</label>
      <div class="col-sm-9">
        <select name="status" class="form-control" ng-model="addSubject.newSubject.status" required>
          <option value="" disabled translate>COMMON.MODELS.STUDY.SUBJECTS.PROVIDERS.STATUS_PLACEHOLDER</option>
          <option ng-repeat="status in addSubject.statuses track by $index" value="{{status}}">{{status}}</option>
        </select>
        <p ng-show="enrollmentForm.status.$invalid"
           class="pull-right required-error" translate>COMMON.MODELS.SYSTEM_FORM.USER.QUESTIONS.INVALID_INPUT</p>
      </div>
    </div>
    <div class="form-group" ng-repeat="(key, values) in addSubject.study.attributes track by $index">
      <label for="{{key}}" class="col-sm-3 control-label">{{key | uppercase}} &nbsp;</label>
      <div class="col-sm-9">
      <select name="studyMapping" ng-model="addSubject.newSubject.studyMapping[key]" class="form-control">
        <option value="" disabled>Select {{key}} options</option>
        <option value="{{option}}" ng-repeat="option in values track by $index">{{option}}</option>
      </select>
      </div>
    </div>
    <div class="form-group">
      <label for="doe" class="col-sm-3 control-label" translate>COMMON.MODELS.STUDY.SUBJECTS.PROVIDERS.DATE_EVENT</label>
      <div class="col-sm-9">
      <p class="input-group">
        <input name="doe" type="text" class="form-control" uib-datepicker-popup ng-model="addSubject.newSubject.doe"
               is-open="addSubject.openedDOE"
               ng-required="addSubject.newSubject.studyMapping" disabled/>
        <span class="input-group-btn">
          <button type="button" class="btn btn-default" ng-click="addSubject.openedDOE = true"><i class="glyphicon glyphicon-calendar"></i></button>
        </span>
        <p ng-show="enrollmentForm.doe.$invalid"
           class="pull-right required-error" translate>COMMON.MODELS.SYSTEM_FORM.USER.QUESTIONS.INVALID_INPUT</p>
      </p>
      </div>
    </div>
    <div class="form-group">
      <label for="centreInput" class="col-sm-3 control-label" translate>COMMON.MODELS.COLLECTION_CENTRE.IDENTITY</label>
      <div class="col-sm-9">
        <select-loader
          name="centreInput"
          url="{{addSubject.centreHref}}"
          is-atomic="true"
          is-disabled="false"
          ng-model="addSubject.newSubject.collectionCentre"
          labels="name"
          required>
        </select-loader>
      </div>
      <div class="col-sm-9">
        <p ng-show="!addSubject.newSubject.collectionCentre"
           class="pull-right required-error" translate>COMMON.MODELS.SYSTEM_FORM.USER.QUESTIONS.INVALID_INPUT</p>
      </div>
    </div>
  </ng-form>

</div>
<div class="modal-footer">
  <button type="submit" id="addSubjectBtn" class="btn btn-primary"
          ng-disabled="subjectForm.$invalid || enrollmentForm.$invalid || !addSubject.newSubject.collectionCentre" ng-click="addSubject.addSubject()" translate>
    COMMON.MODELS.STUDY.SUBJECTS.ADD_BUTTON
  </button>
  <button type="button" id="cancelBtn" class="btn btn-warning" ng-click="addSubject.cancel()" translate>
    COMMON.MODELS.STUDY.SUBJECTS.CANCEL
  </button>
</div>
